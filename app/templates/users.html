{% extends "base.html" %}
{% block title %}Users{% endblock %}
{% block content %}
<h1>Users</h1>

<div class="card">
    <h2>Add User</h2>
    <form method="POST" action="/admin/users">
        <div class="form-row">
            <div class="form-group">
                <label for="telegram_id">Telegram User ID</label>
                <input type="number" id="telegram_id" name="telegram_id" placeholder="123456789" required style="width:180px">
            </div>
            <div class="form-group">
                <label for="role">Role</label>
                <select id="role" name="role">
                    <option value="user">user</option>
                    <option value="admin">admin</option>
                </select>
            </div>
            <div class="form-group" style="justify-content:flex-end">
                <button type="submit" class="btn btn-primary">Add</button>
            </div>
        </div>
    </form>
</div>

<div class="card">
    <h2>All Users ({{ users | length }})</h2>
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Telegram User ID</th>
                    <th>Role</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td><code>{{ user.telegram_user_id }}</code></td>
                <td>
                    <span class="badge badge-{{ user.role.name if user.role else 'user' }}">
                        {{ user.role.name if user.role else '?' }}
                    </span>
                </td>
                <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else '—' }}</td>
                <td style="display:flex;gap:6px;flex-wrap:wrap">
                    {% if user.role and user.role.name != 'admin' %}
                    <form method="POST" action="/admin/users/role">
                        <input type="hidden" name="telegram_id" value="{{ user.telegram_user_id }}">
                        <input type="hidden" name="role" value="admin">
                        <button type="submit" class="btn btn-sm btn-primary">→ admin</button>
                    </form>
                    {% endif %}
                    {% if user.role and user.role.name != 'user' %}
                    <form method="POST" action="/admin/users/role">
                        <input type="hidden" name="telegram_id" value="{{ user.telegram_user_id }}">
                        <input type="hidden" name="role" value="user">
                        <button type="submit" class="btn btn-sm btn-secondary">→ user</button>
                    </form>
                    {% endif %}
                    <form method="POST" action="/admin/users/delete"
                          onsubmit="return confirm('Delete user {{ user.telegram_user_id }}?')">
                        <input type="hidden" name="telegram_id" value="{{ user.telegram_user_id }}">
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="5" style="color:#6c757d;text-align:center">No users found.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
